webpackJsonp([4],{"6LeE":function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e,n=s("lC5x"),r=s.n(n),o=s("J0Oq"),i=s.n(o),c=s("Yarq"),u=s.n(c),d=s("AA3o"),l=s.n(d),f=s("xSur"),p=s.n(f),v=s("UzKs"),h=s.n(v),w=s("Y7Ml"),m=s.n(w),_=s("4YfN"),g=s.n(_),y=s("VCXJ"),P=s("9ZwC"),k=s.n(P),b=s("9rMa"),x=s("hL+H"),C=k()({computed:g()({},Object(b.b)({coverPrefix:function(t){return t.article.coverPrefix},userInfo:function(t){return t.userInfo}}))})(e=function(t){function a(){var t,s,e,n;l()(this,a);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return s=e=h()(this,(t=a.__proto__||u()(a)).call.apply(t,[this].concat(o))),e.userId="",e.account="",e.showModifyAccount=!1,e.accountModifying=!1,e.uploadToken="",e.loading=!1,e.showForm=!1,e.oldPasswd="",e.newPasswd="",e.newPasswdConfirm="",e.rules={passwd:[{required:!0,message:"密码不得为空",trigger:"blur"},{min:5,max:16,message:"密码长度应在5到16之间",trigger:"blur"}]},n=s,h()(e,n)}return m()(a,t),p()(a,[{key:"created",value:function(){this.userId=this.userInfo.id,this.account=this.userInfo.account}},{key:"checkSamePasswd",value:function(){return this.newPasswd!==this.newPasswdConfirm?new Error("两次输入密码不一致"):""}},{key:"modifyAccount",value:function(){var t=i()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.accountModifying=!0,t.prev=1,t.next=4,x.a.update(this.userId,{account:this.account,action:"modifyAccount"});case 4:this.showModifyAccount=!1,t.next=11;break;case 7:t.prev=7,t.t0=t.catch(1),this.account=this.userInfo.account,this.$message.error(t.t0.message);case 11:return t.prev=11,this.accountModifying=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[1,7,11,14]])}));return function(){return t.apply(this,arguments)}}()},{key:"getAvatar",value:function(){var t=i()(r.a.mark(function t(a){var s,e,n=this;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=JSON.parse(window.sessionStorage.getItem("userInfo")),e=this.coverPrefix+a.hash,s.avatar=e,this.$store.dispatch("setUserInfo",s).then(i()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.modifyAvatar(e);case 2:n.avatar=e;case 3:case"end":return t.stop()}},t,n)})));case 4:case"end":return t.stop()}},t,this)}));return function(a){return t.apply(this,arguments)}}()},{key:"modifyAvatar",value:function(){var t=i()(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x.a.update(this.userId,{avatar:a,action:"modifyAvatar"});case 3:this.$notify.success("头像已更新"),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.$message.error(t.t0.message);case 9:case"end":return t.stop()}},t,this,[[0,6]])}));return function(a){return t.apply(this,arguments)}}()},{key:"closeDialog",value:function(){this.showForm=!1,this.oldPasswd="",this.newPasswd="",this.newPasswdConfirm=""}},{key:"updatePwd",value:function(){var t=i()(r.a.mark(function t(){var a=this;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,x.a.update(this.userId,{oldPasswd:this.oldPasswd,newPasswd:this.newPasswd,action:"modifyPasswd"});case 4:this.$notify.success("密码修改成功，请重新登录"),this.$store.dispatch("logout").then(function(){return a.$router.replace("/login")}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.$message.error(t.t0.message);case 11:return t.prev=11,this.loading=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[1,8,11,14]])}));return function(){return t.apply(this,arguments)}}()}]),a}(y.default))||e,A={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"ta-page"},[s("div",{staticClass:"ta-page__info"},[s("div",{staticClass:"head"},[s("ta-icon",{attrs:{name:"person"}}),t._v(" "),s("span",[t._v("个人信息")])],1),t._v(" "),s("div",{staticClass:"body"},[s("div",{staticClass:"ta-page__info-item"},[s("label",[t._v("用户账户：")]),t._v(" "),t.showModifyAccount?[s("ta-input",{attrs:{focus:t.showModifyAccount},model:{value:t.account,callback:function(a){t.account=a},expression:"account"}}),t._v(" "),s("ta-button",{attrs:{loading:t.accountModifying},on:{click:function(a){t.modifyAccount()}}},[t._v("保存")]),t._v(" "),s("ta-button",{on:{click:function(a){t.showModifyAccount=!1}}},[t._v("取消")])]:[s("span",[t._v(t._s(t.account))]),t._v(" "),s("ta-button",{on:{click:function(a){t.showModifyAccount=!0}}},[t._v("修改")])]],2),t._v(" "),s("div",{staticClass:"ta-page__info-item"},[s("label",[t._v("用户头像：")]),t._v(" "),s("ta-upload",{attrs:{cover:t.userInfo.avatar},on:{success:function(a){t.getAvatar(a)}}})],1),t._v(" "),s("div",{staticClass:"ta-page__info-item"},[s("label",[t._v("登录密码：")]),t._v(" "),t.showForm?s("div",{staticClass:"ta-page__form-container"},[s("ta-form",{staticClass:"ta-page__form",attrs:{rules:t.rules},on:{submit:t.updatePwd}},[s("ta-form-item",{attrs:{prop:"account",type:"password",placeholder:"请输入原密码",rules:t.rules.passwd},model:{value:t.oldPasswd,callback:function(a){t.oldPasswd=a},expression:"oldPasswd"}}),t._v(" "),s("ta-form-item",{attrs:{prop:"password",placeholder:"请输入密码",type:"password",rules:t.rules.passwd},model:{value:t.newPasswd,callback:function(a){t.newPasswd=a},expression:"newPasswd"}}),t._v(" "),s("ta-form-item",{attrs:{prop:"passwordConfirm",validator:t.checkSamePasswd,placeholder:"请再次输入密码",type:"password",rules:t.rules.passwd},model:{value:t.newPasswdConfirm,callback:function(a){t.newPasswdConfirm=a},expression:"newPasswdConfirm"}}),t._v(" "),s("div",[s("ta-button",{attrs:{size:"small",loading:t.loading,type:"primary"}},[t._v("确认")])],1)],1),t._v(" "),s("ta-button",{staticClass:"btn-cancel",attrs:{size:"small"},on:{click:t.closeDialog}},[t._v("取消")])],1):s("ta-button",{on:{click:function(a){t.showForm=!0}}},[t._v("修改密码")])],1),t._v(" "),s("div",{staticClass:"ta-page__info-item"},[s("label",[t._v("用户角色：")]),t._v(" "),s("span",[t._v(t._s(t.userInfo.roles.join("、")))])])])])])},staticRenderFns:[]};var I=s("Z0/y")(C,A,!1,function(t){s("fWAg")},"data-v-c27dfb5a",null);a.default=I.exports},fWAg:function(t,a){}});
//# sourceMappingURL=ownspace.561f8a7e5ed33a7830eb.js.map