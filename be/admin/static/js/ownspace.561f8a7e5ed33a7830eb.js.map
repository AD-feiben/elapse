{"version":3,"sources":["webpack:///src/views/ownspace/index.vue","webpack:///./src/views/ownspace/index.vue?3802","webpack:///./src/views/ownspace/index.vue"],"names":["computed","extends_default","Object","vuex_esm","coverPrefix","userInfo","_dec","_class","_Vue","_this","account","showModifyAccount","accountModifying","uploadToken","loading","showForm","oldPasswd","newPasswd","newPasswdConfirm","rules","required","message","trigger","min","max","_temp","possibleConstructorReturn_default","_ret","id","res","hash","avatar","then","asyncToGenerator_default","regenerator_default","a","mark","_callee2","wrap","_context2","vue_esm","ownspace","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","name","_v","focus","model","value","callback","$$v","expression","on","click","$event","modifyAccount","_s","cover","success","getAvatar","submit","updatePwd","prop","type","placeholder","passwd","validator","checkSamePasswd","size","closeDialog","roles","join","staticRenderFns","Component","__webpack_require__","normalizeComponent","ownspace_Ownspace","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/ownspace.561f8a7e5ed33a7830eb.js","sourcesContent":["<template>\n  <div class=\"ta-page\">\n    <div class=\"ta-page__info\">\n      <div class=\"head\">\n        <ta-icon name=\"person\"></ta-icon>\n        <span>个人信息</span>\n      </div>\n      <div class=\"body\">\n        <!-- 用户账户 -->\n        <div class=\"ta-page__info-item\">\n          <label>用户账户：</label>\n          <template v-if=\"!showModifyAccount\">\n            <span>{{ account }}</span>\n            <ta-button @click=\"showModifyAccount = true\">修改</ta-button>\n          </template>\n          <template v-else>\n            <ta-input  :focus=\"showModifyAccount\" v-model=\"account\"></ta-input>\n            <ta-button :loading=\"accountModifying\" @click=\"modifyAccount()\">保存</ta-button>\n            <ta-button @click=\"showModifyAccount = false\">取消</ta-button>\n          </template>\n        </div>\n        \n        <!-- 用户头像 -->\n        <div class=\"ta-page__info-item\">\n          <label>用户头像：</label>\n          <ta-upload :cover=\"userInfo.avatar\" @success=\"getAvatar($event)\"></ta-upload>\n        </div>\n\n        <!-- 修改密码 -->\n        <div class=\"ta-page__info-item\">\n          <label>登录密码：</label>\n          <ta-button v-if=\"!showForm\" @click=\"showForm = true\">修改密码</ta-button>\n          <div v-else class=\"ta-page__form-container\">\n            <ta-form class=\"ta-page__form\" :rules=\"rules\" @submit=\"updatePwd\">\n              <ta-form-item\n                prop=\"account\"\n                type=\"password\"\n                placeholder=\"请输入原密码\" v-model=\"oldPasswd\" :rules=\"rules.passwd\">\n              </ta-form-item>\n              <ta-form-item\n                prop=\"password\"\n                placeholder=\"请输入密码\" type=\"password\" \n                v-model=\"newPasswd\" :rules=\"rules.passwd\">\n              </ta-form-item>\n              <ta-form-item\n                prop=\"passwordConfirm\"\n                :validator=\"checkSamePasswd\"\n                placeholder=\"请再次输入密码\" type=\"password\" \n                v-model=\"newPasswdConfirm\" :rules=\"rules.passwd\">\n              </ta-form-item>\n              \n              <div>\n                <ta-button size=\"small\" :loading=\"loading\" type=\"primary\">确认</ta-button>\n              </div>\n            </ta-form>\n            <ta-button class=\"btn-cancel\" size=\"small\" @click=\"closeDialog\">取消</ta-button>\n          </div>\n        </div>\n        \n        <!-- 用户角色 -->\n        <div class=\"ta-page__info-item\">\n          <label>用户角色：</label>\n          <span>{{ userInfo.roles.join('、') }}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue'\nimport Component from 'vue-class-component'\nimport { mapState } from 'vuex'\nimport { UserProvider } from '@/provider/user-provider'\n\n@Component({\n  computed: {\n    ...mapState({\n      coverPrefix: state => state.article.coverPrefix,\n      userInfo: state => state.userInfo,\n    })\n  }\n})\nexport default class Ownspace extends Vue {\n  userId = ''\n  account = ''\n  // 修改账户\n  showModifyAccount = false\n  accountModifying = false\n  // 修改头像\n  uploadToken = ''\n  // 修改密码\n  loading = false\n  showForm = false\n  oldPasswd = ''\n  newPasswd = ''\n  newPasswdConfirm = ''\n\n  rules = {\n    passwd: [\n      { required: true, message: '密码不得为空', trigger: 'blur' },\n      { min: 5, max: 16, message: '密码长度应在5到16之间', trigger: 'blur' }\n    ],\n  }\n\n  created() {\n    this.userId = this.userInfo.id\n    this.account = this.userInfo.account\n  }\n\n  checkSamePasswd() {\n    if (this.newPasswd !== this.newPasswdConfirm) {\n      return new Error('两次输入密码不一致')\n    } else {\n      return ''\n    }\n  }\n\n  // 修改账户\n  async modifyAccount() {\n    this.accountModifying = true\n    try {\n      await UserProvider.update(this.userId, {\n        account: this.account,\n        action: 'modifyAccount'\n      })\n      this.showModifyAccount = false\n    } catch (err) {\n      this.account = this.userInfo.account\n      this.$message.error(err.message)\n    } finally {\n      this.accountModifying = false\n    }\n  }\n\n  // 上传新头像\n  async getAvatar(res) {\n    const userInfo = JSON.parse(window.sessionStorage.getItem('userInfo'))\n    const avatar = this.coverPrefix + res.hash\n\n    userInfo.avatar = avatar\n    \n    this.$store.dispatch('setUserInfo', userInfo)\n      .then(async () => {\n        await this.modifyAvatar(avatar)\n        this.avatar = avatar\n      })\n  }\n\n  // 修改头像\n  async modifyAvatar(avatar) {\n    try {\n      await UserProvider.update(this.userId, {\n        avatar,\n        action: 'modifyAvatar'\n      })\n      this.$notify.success('头像已更新')\n    } catch (err) {\n      this.$message.error(err.message)\n    }\n  }\n\n\n  // 关闭弹窗\n  closeDialog() {\n    this.showForm = false\n    this.oldPasswd = ''\n    this.newPasswd = ''\n    this.newPasswdConfirm = ''\n  }\n\n  // 更新密码\n  async updatePwd() {\n    this.loading = true\n    try {\n      await UserProvider.update(this.userId, {\n        oldPasswd: this.oldPasswd,\n        newPasswd: this.newPasswd,\n        action: 'modifyPasswd'\n      })\n      this.$notify.success('密码修改成功，请重新登录')\n      this.$store.dispatch('logout')\n        .then(() => this.$router.replace('/login'))\n    } catch (err) {\n      this.$message.error(err.message)\n    } finally {\n      this.loading = false\n    }    \n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './style.scss';\n</style>\n\n\n\n\n// WEBPACK FOOTER //\n// src/views/ownspace/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"ta-page\"},[_c('div',{staticClass:\"ta-page__info\"},[_c('div',{staticClass:\"head\"},[_c('ta-icon',{attrs:{\"name\":\"person\"}}),_vm._v(\" \"),_c('span',[_vm._v(\"个人信息\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"body\"},[_c('div',{staticClass:\"ta-page__info-item\"},[_c('label',[_vm._v(\"用户账户：\")]),_vm._v(\" \"),(!_vm.showModifyAccount)?[_c('span',[_vm._v(_vm._s(_vm.account))]),_vm._v(\" \"),_c('ta-button',{on:{\"click\":function($event){_vm.showModifyAccount = true}}},[_vm._v(\"修改\")])]:[_c('ta-input',{attrs:{\"focus\":_vm.showModifyAccount},model:{value:(_vm.account),callback:function ($$v) {_vm.account=$$v},expression:\"account\"}}),_vm._v(\" \"),_c('ta-button',{attrs:{\"loading\":_vm.accountModifying},on:{\"click\":function($event){_vm.modifyAccount()}}},[_vm._v(\"保存\")]),_vm._v(\" \"),_c('ta-button',{on:{\"click\":function($event){_vm.showModifyAccount = false}}},[_vm._v(\"取消\")])]],2),_vm._v(\" \"),_c('div',{staticClass:\"ta-page__info-item\"},[_c('label',[_vm._v(\"用户头像：\")]),_vm._v(\" \"),_c('ta-upload',{attrs:{\"cover\":_vm.userInfo.avatar},on:{\"success\":function($event){_vm.getAvatar($event)}}})],1),_vm._v(\" \"),_c('div',{staticClass:\"ta-page__info-item\"},[_c('label',[_vm._v(\"登录密码：\")]),_vm._v(\" \"),(!_vm.showForm)?_c('ta-button',{on:{\"click\":function($event){_vm.showForm = true}}},[_vm._v(\"修改密码\")]):_c('div',{staticClass:\"ta-page__form-container\"},[_c('ta-form',{staticClass:\"ta-page__form\",attrs:{\"rules\":_vm.rules},on:{\"submit\":_vm.updatePwd}},[_c('ta-form-item',{attrs:{\"prop\":\"account\",\"type\":\"password\",\"placeholder\":\"请输入原密码\",\"rules\":_vm.rules.passwd},model:{value:(_vm.oldPasswd),callback:function ($$v) {_vm.oldPasswd=$$v},expression:\"oldPasswd\"}}),_vm._v(\" \"),_c('ta-form-item',{attrs:{\"prop\":\"password\",\"placeholder\":\"请输入密码\",\"type\":\"password\",\"rules\":_vm.rules.passwd},model:{value:(_vm.newPasswd),callback:function ($$v) {_vm.newPasswd=$$v},expression:\"newPasswd\"}}),_vm._v(\" \"),_c('ta-form-item',{attrs:{\"prop\":\"passwordConfirm\",\"validator\":_vm.checkSamePasswd,\"placeholder\":\"请再次输入密码\",\"type\":\"password\",\"rules\":_vm.rules.passwd},model:{value:(_vm.newPasswdConfirm),callback:function ($$v) {_vm.newPasswdConfirm=$$v},expression:\"newPasswdConfirm\"}}),_vm._v(\" \"),_c('div',[_c('ta-button',{attrs:{\"size\":\"small\",\"loading\":_vm.loading,\"type\":\"primary\"}},[_vm._v(\"确认\")])],1)],1),_vm._v(\" \"),_c('ta-button',{staticClass:\"btn-cancel\",attrs:{\"size\":\"small\"},on:{\"click\":_vm.closeDialog}},[_vm._v(\"取消\")])],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"ta-page__info-item\"},[_c('label',[_vm._v(\"用户角色：\")]),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.userInfo.roles.join('、')))])])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler?{\"id\":\"data-v-c27dfb5a\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.1@vue-loader/lib/selector.js?type=template&index=0!./src/views/ownspace/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-c27dfb5a\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader!sass-resources-loader?{\\\"resources\\\":[\\\"/home/zhaoxu/repo/newton/personal/elapse/be/src/theme/index.scss\\\"]}!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-c27dfb5a\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@13.7.1@vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-c27dfb5a\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/ownspace/index.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}